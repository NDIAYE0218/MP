<div class="corps">
  <h1>Liste des Marchés</h1>
  <div class="recherche">
    <br>
    <form [formGroup]="createForm">
      <mat-form-field class="act-form">
        <input matInput placeholder="Trier par date" [matDatepicker]="picker" formControlName="Annee_rech" #Annee_rech>
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker startView="year"></mat-datepicker>
      </mat-form-field><span class="ou"> OU </span>
      <mat-form-field class="act-form">
        <input matInput placeholder="Recherche par N° du marché" type="text" formControlName="ID_rech" #ID_rech>
      </mat-form-field>
      <button type="submit" [disabled]="createForm.pristine || createForm.invalid"
        (click)="rechercher(Annee_rech.value,ID_rech.value);Annee_rech.value='';ID_rech.value=''" mat-raised-button
        color="primary">
        <mat-icon>search</mat-icon>
      </button>
    </form>
  </div>
  <mat-tab-group animationDuration="1000ms" class="hedtab">
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>info</mat-icon>
        <h2>&nbsp;Informations générales</h2>
      </ng-template>
      <br><br>
      <!--Information general debut-->
      <table mat-table [dataSource]="marches">
        <ng-container matColumnDef="NumMarche">
          <th mat-header-cell *matHeaderCellDef>N° du marché&nbsp;</th>
          <td mat-cell *matCellDef="let element">
            <span *ngIf="element.NumMarche.toString().length===1">{{element.An}}-00{{element.NumMarche}}</span>
            <span *ngIf="element.NumMarche.toString().length===2">{{element.An}}-0{{element.NumMarche}}</span>
            <span *ngIf="element.NumMarche.toString().length===3">{{element.An}}-{{element.NumMarche}}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="objet">
          <th mat-header-cell *matHeaderCellDef>Objet&nbsp;</th>
          <td mat-cell *matCellDef="let element"> {{element.objet}}&nbsp; </td>
        </ng-container>

        <ng-container matColumnDef="nature">
          <th mat-header-cell *matHeaderCellDef>Nature&nbsp;</th>
          <td mat-cell *matCellDef="let element"> {{element.Nature}}&nbsp; </td>
        </ng-container>

        <ng-container matColumnDef="procedure">
          <th mat-header-cell *matHeaderCellDef>Type de procédure&nbsp;</th>
          <td mat-cell *matCellDef="let element">{{element.Type_process}}&nbsp;</td>
        </ng-container>
        <ng-container matColumnDef="typeMarche">
          <th mat-header-cell *matHeaderCellDef>Forme et type du marché&nbsp;</th>
          <td mat-cell *matCellDef="let element"><b>{{element.Format_process}}</b> / {{element.Type_Marche}}&nbsp;</td>
        </ng-container>
        <ng-container matColumnDef="act">
          <th mat-header-cell *matHeaderCellDef class="mat-column-right">Actions</th>
          <td mat-cell *matCellDef="let element" class="mat-column-right">
            <button mat-button color="primary"
              routerLink="/marches/{{element.An}}-{{element.NumMarche}}"><mat-icon>remove_red_eye</mat-icon></button>
            <button mat-button color="" *ngIf="element.historique.length>0" (click)="historique(element.historique)"><mat-icon>history</mat-icon></button>
            <button mat-button color="accent" (click)="modifier(element)" *ngIf="droit>=1"><mat-icon>create</mat-icon></button>
            <button mat-button color="warn" (click)="suppmarche(element.An,element.NumMarche)" *ngIf="droit>=2"><mat-icon>delete_forever</mat-icon></button>
            <button mat-button style="color: darkblue" (click)="Telecharger(element)" ><mat-icon>vertical_align_bottom</mat-icon></button>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="ColumnsInformation"></tr>
        <tr mat-row *matRowDef="let row; columns: ColumnsInformation;"></tr>
      </table>
      <!--Information general fin-->
    </mat-tab>
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>all_out</mat-icon>
        <h2>&nbsp;Directions</h2>
      </ng-template>
      <br><br>
      <table mat-table [dataSource]="marches">
        <ng-container matColumnDef="NumMarche">
          <th mat-header-cell *matHeaderCellDef>N° du marché&nbsp;</th>
          <td mat-cell *matCellDef="let element">
            <span *ngIf="element.NumMarche.toString().length===1">{{element.An}}-00{{element.NumMarche}}</span>
            <span *ngIf="element.NumMarche.toString().length===2">{{element.An}}-0{{element.NumMarche}}</span>
            <span *ngIf="element.NumMarche.toString().length===3">{{element.An}}-{{element.NumMarche}}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="objet">
          <th mat-header-cell *matHeaderCellDef>Objet&nbsp;</th>
          <td mat-cell *matCellDef="let element"> {{element.objet}}&nbsp; </td>
        </ng-container>

        <ng-container matColumnDef="DG">
          <th mat-header-cell *matHeaderCellDef>Direction&nbsp;</th>
          <td mat-cell *matCellDef="let element"> {{element.DG}}&nbsp; </td>
        </ng-container>

        <ng-container matColumnDef="serv">
          <th mat-header-cell *matHeaderCellDef>Services&nbsp;</th>
          <td mat-cell *matCellDef="let element"> {{element.serv}}&nbsp; </td>
        </ng-container>


        <ng-container matColumnDef="Contacte">
          <th mat-header-cell *matHeaderCellDef>Contact&nbsp;</th>
          <td mat-cell *matCellDef="let element"> {{element.Contacte}}&nbsp; </td>
        </ng-container>

        <ng-container matColumnDef="act">
          <th mat-header-cell *matHeaderCellDef class="mat-column-right">Actions</th>
          <td mat-cell *matCellDef="let element" class="mat-column-right">
            <button mat-button color="primary"
              routerLink="/marches/{{element.An}}-{{element.NumMarche}}"><mat-icon>remove_red_eye</mat-icon></button>
            <button mat-button color="" *ngIf="element.historique.length>0" (click)="historique(element.historique)"><mat-icon>history</mat-icon></button>
            <button mat-button color="accent" (click)="modifier(element)" *ngIf="droit>=1"><mat-icon>create</mat-icon></button>
            <button mat-button color="warn" (click)="suppmarche(element.An,element.NumMarche)" *ngIf="droit>=2"><mat-icon>delete_forever</mat-icon></button>
            <button mat-button style="color: darkblue" (click)="Telecharger(element)" ><mat-icon>vertical_align_bottom</mat-icon></button>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="ColumnsDirection"></tr>
        <tr mat-row *matRowDef="let row; columns: ColumnsDirection;"></tr>

      </table>
    </mat-tab>
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>euro_symbol</mat-icon>
        <h2>&nbsp;Montants</h2>
      </ng-template>
      <br><br>
      <table mat-table [dataSource]="marches">
        <ng-container matColumnDef="NumMarche">
          <th mat-header-cell *matHeaderCellDef>N° du marché&nbsp;</th>
          <td mat-cell *matCellDef="let element">
            <span *ngIf="element.NumMarche.toString().length===1">{{element.An}}-00{{element.NumMarche}}</span>
            <span *ngIf="element.NumMarche.toString().length===2">{{element.An}}-0{{element.NumMarche}}</span>
            <span *ngIf="element.NumMarche.toString().length===3">{{element.An}}-{{element.NumMarche}}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="objet">
          <th mat-header-cell *matHeaderCellDef>Objet&nbsp;</th>
          <td mat-cell *matCellDef="let element"> {{element.objet}} </td>
        </ng-container>

        <ng-container matColumnDef="typeMarche">
          <th mat-header-cell *matHeaderCellDef>Forme et type du marché&nbsp;</th>
          <td mat-cell *matCellDef="let element"><b>{{element.Format_process}}</b> / {{element.Type_Marche}}&nbsp;</td>
        </ng-container>
        <ng-container matColumnDef="montantmin">
          <th mat-header-cell *matHeaderCellDef>Montant min&nbsp;</th>
          <td mat-cell *matCellDef="let element">{{element.Montant_Min}}&nbsp;</td>
        </ng-container>
        <ng-container matColumnDef="montantdeb">
          <th mat-header-cell *matHeaderCellDef>Montant déboursé&nbsp;</th>
          <td mat-cell *matCellDef="let element"><b>{{element.MontantConsome}}&nbsp;</b></td>
        </ng-container>
        <ng-container matColumnDef="montantmax">
          <th mat-header-cell *matHeaderCellDef>Montant max&nbsp;</th>
          <td mat-cell *matCellDef="let element">{{element.Montant_Max}}&nbsp;</td>
        </ng-container>
        <ng-container matColumnDef="act">
          <th mat-header-cell *matHeaderCellDef class="mat-column-right">Actions</th>
          <td mat-cell *matCellDef="let element" class="mat-column-right">
            <button mat-button color="primary"
              routerLink="/marches/{{element.An}}-{{element.NumMarche}}"><mat-icon>remove_red_eye</mat-icon></button>
            <button mat-button color="" *ngIf="element.historique.length>0" (click)="historique(element.historique)"><mat-icon>history</mat-icon></button>
            <button mat-button color="accent" (click)="modifier(element)" *ngIf="droit>=1"><mat-icon>create</mat-icon></button>
            <button mat-button color="warn" (click)="suppmarche(element.An,element.NumMarche)" *ngIf="droit>=2"><mat-icon>delete_forever</mat-icon></button>
            <button mat-button style="color: darkblue" (click)="Telecharger(element)" ><mat-icon>vertical_align_bottom</mat-icon></button>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="ColumnsMontant"></tr>
        <tr mat-row *matRowDef="let row; columns: ColumnsMontant;"></tr>
      </table>
      <!--Information general fin-->
    </mat-tab>
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>subtitles</mat-icon>
        <h2>&nbsp;Titulaire et sous traitant</h2>
      </ng-template>
      <table mat-table [dataSource]="marches">
        <ng-container matColumnDef="NumMarche">
          <th mat-header-cell *matHeaderCellDef>N° du marché&nbsp;</th>
          <td mat-cell *matCellDef="let element">
            <span *ngIf="element.NumMarche.toString().length===1">{{element.An}}-00{{element.NumMarche}}</span>
            <span *ngIf="element.NumMarche.toString().length===2">{{element.An}}-0{{element.NumMarche}}</span>
            <span *ngIf="element.NumMarche.toString().length===3">{{element.An}}-{{element.NumMarche}}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="objet">
          <th mat-header-cell *matHeaderCellDef>Objet&nbsp;</th>
          <td mat-cell *matCellDef="let element"> {{element.objet}}&nbsp; </td>
        </ng-container>
        <ng-container matColumnDef="Type">
          <th mat-header-cell *matHeaderCellDef>Type traitants&nbsp;</th>
          <td mat-cell *matCellDef="let element" class="tgd">
            <tr>&nbsp;&nbsp;<b>Titulaire</b><br></tr>
            <tr class="tgd" *ngFor="let sous_trait of element.SousTraitants;">&nbsp;&nbsp;Sous traitant<br></tr>
          </td>
        </ng-container>
        <ng-container matColumnDef="Nom">
          <th mat-header-cell *matHeaderCellDef>Nom entreprise&nbsp;</th>
          <td mat-cell *matCellDef="let element" class="tgd">
            <tr>&nbsp;&nbsp;<b>{{element.Titulaire.Nom}}</b><br></tr>
            <tr class="tgd" *ngFor="let sous_trait of element.SousTraitants;">&nbsp;&nbsp;{{sous_trait.Nom}}&nbsp;<br></tr>
          </td>
        </ng-container>

        <ng-container matColumnDef="Nom_Contacte">
          <th mat-header-cell *matHeaderCellDef>Nom contact&nbsp;</th>
          <td mat-cell *matCellDef="let element" class="tgd">
            <tr>&nbsp;&nbsp;<b>{{element.Titulaire.Contacte}}</b><br></tr>
            <tr class="tgd" *ngFor="let sous_trait of element.SousTraitants;">&nbsp;{{sous_trait.Contacte}}&nbsp; <br>
            </tr>
          </td>
        </ng-container>
        <ng-container matColumnDef="Mail_Contacte">
          <th mat-header-cell *matHeaderCellDef>Email contacte&nbsp;</th>
          <td mat-cell *matCellDef="let element" class="tgd">
            <tr>&nbsp;&nbsp;<b>{{element.Titulaire.Mail}}</b><br></tr>
            <tr class="tgd" *ngFor="let sous_trait of element.SousTraitants;">&nbsp;{{sous_trait.Mail}}&nbsp;<br></tr>
          </td>
        </ng-container>
        <ng-container matColumnDef="Adresse">
          <th mat-header-cell *matHeaderCellDef>Adresse&nbsp;</th>
          <td mat-cell *matCellDef="let element" class="tgd">
            <tr>&nbsp;&nbsp;<b>{{element.Titulaire.Adresse_1}} - {{element.Titulaire.Adresse_2}} -
                {{element.Titulaire.Ville}}({{element.Titulaire.CP}})</b><br></tr>
            <tr class="tgd" *ngFor="let sous_trait of element.SousTraitants;">&nbsp;&nbsp;{{sous_trait.Adresse_1}} -
              {{sous_trait.Adresse_2}} - {{sous_trait.Ville}}({{sous_trait.CP}})<br></tr>
          </td>
        </ng-container>

        <ng-container matColumnDef="act">
          <th mat-header-cell *matHeaderCellDef class="mat-column-right">Actions</th>
          <td mat-cell *matCellDef="let element" class="mat-column-right">
            <button mat-button color="primary"
              routerLink="/marches/{{element.An}}-{{element.NumMarche}}"><mat-icon>remove_red_eye</mat-icon></button>
            <button mat-button color="" *ngIf="element.historique.length>0" (click)="historique(element.historique)"><mat-icon>history</mat-icon></button>
            <button mat-button color="accent" (click)="modifier(element)" *ngIf="droit>=1"><mat-icon>create</mat-icon></button>
            <button mat-button color="warn" (click)="suppmarche(element.An,element.NumMarche)" *ngIf="droit>=2"><mat-icon>delete_forever</mat-icon></button>
            <button mat-button style="color: darkblue" (click)="Telecharger(element)" ><mat-icon>vertical_align_bottom</mat-icon></button>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="ColumsTitulaire"></tr>
        <tr mat-row *matRowDef="let row; columns: ColumsTitulaire;"></tr>
      </table>
    </mat-tab>
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>calendar_today</mat-icon>
        <h2>&nbsp;Dates</h2>
      </ng-template>
      <table mat-table [dataSource]="marches">
        <ng-container matColumnDef="NumMarche">
          <th mat-header-cell *matHeaderCellDef>N° du marché&nbsp;</th>
          <td mat-cell *matCellDef="let element">
            <span *ngIf="element.NumMarche.toString().length===1">{{element.An}}-00{{element.NumMarche}}</span>
            <span *ngIf="element.NumMarche.toString().length===2">{{element.An}}-0{{element.NumMarche}}</span>
            <span *ngIf="element.NumMarche.toString().length===3">{{element.An}}-{{element.NumMarche}}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="objet">
          <th mat-header-cell *matHeaderCellDef>Objet&nbsp;</th>
          <td mat-cell *matCellDef="let element"> {{element.objet}}&nbsp; </td>
        </ng-container>
        <ng-container matColumnDef="dte_not">
          <th mat-header-cell *matHeaderCellDef>Date de notification&nbsp;</th>
          <td mat-cell *matCellDef="let element">{{element.DateNotific}}&nbsp;</td>
        </ng-container>
        <ng-container matColumnDef="dte_clo">
          <th mat-header-cell *matHeaderCellDef>Date de cloture&nbsp;</th>
          <td mat-cell *matCellDef="let element"><b>{{element.D_clot}}&nbsp;</b></td>
        </ng-container>
        <ng-container matColumnDef="duree">
          <th mat-header-cell *matHeaderCellDef>Durée initiale&nbsp;</th>
          <td mat-cell *matCellDef="let element">{{element.D_init}}&nbsp;</td>
        </ng-container>
        <ng-container matColumnDef="tot_recond">
          <th mat-header-cell *matHeaderCellDef>Nbre de reconduction</th>
          <td mat-cell *matCellDef="let element"><b>{{element.Nbr_reconduction}}&nbsp;</b></td>
        </ng-container>
        <ng-container matColumnDef="duree_total">
          <th mat-header-cell *matHeaderCellDef>Durée totale&nbsp;</th>
          <td mat-cell *matCellDef="let element">{{element.D_tot}}&nbsp;</td>
        </ng-container>
        <ng-container matColumnDef="act">
          <th mat-header-cell *matHeaderCellDef class="mat-column-right">Actions</th>
          <td mat-cell *matCellDef="let element" class="mat-column-right">
            <button mat-button color="primary"
              routerLink="/marches/{{element.An}}-{{element.NumMarche}}"><mat-icon>remove_red_eye</mat-icon></button>
            <button mat-button color="" *ngIf="element.historique.length>0" (click)="historique(element.historique)"><mat-icon>history</mat-icon></button>
            <button mat-button color="accent" (click)="modifier(element)" *ngIf="droit>=1"><mat-icon>create</mat-icon></button>
            <button mat-button color="warn" (click)="suppmarche(element.An,element.NumMarche)" *ngIf="droit>=2"><mat-icon>delete_forever</mat-icon></button>
            <button mat-button style="color: darkblue" (click)="Telecharger(element)" ><mat-icon>vertical_align_bottom</mat-icon></button>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="ColumnsDates"></tr>
        <tr mat-row *matRowDef="let row; columns: ColumnsDates;"></tr>
      </table>
    </mat-tab>
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon>attachment</mat-icon>
        <h2>&nbsp;Fichiers associés</h2>
      </ng-template>
      <table mat-table [dataSource]="marches">
        <ng-container matColumnDef="NumMarche">
          <th mat-header-cell *matHeaderCellDef>N° du marché&nbsp;</th>
          <td mat-cell *matCellDef="let element">
            <span *ngIf="element.NumMarche.toString().length===1">{{element.An}}-00{{element.NumMarche}}</span>
            <span *ngIf="element.NumMarche.toString().length===2">{{element.An}}-0{{element.NumMarche}}</span>
            <span *ngIf="element.NumMarche.toString().length===3">{{element.An}}-{{element.NumMarche}}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="objet">
          <th mat-header-cell *matHeaderCellDef>Objet&nbsp;</th>
          <td mat-cell *matCellDef="let element"> {{element.objet}} </td>
        </ng-container>
        <ng-container matColumnDef="fichiers">
          <th mat-header-cell *matHeaderCellDef>Fichiers&nbsp;</th>
          <td mat-cell *matCellDef="let element" class="tgd">
            <tr *ngFor="let pcj of element.Piece_Jointe;">&nbsp;&nbsp;{{pcj.numero+1}}-
              {{pcj.nom.substring(26)}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a
                href="http://localhost:4000/file_marche/{{pcj.nom}}" target="_blank">
                <mat-icon>vertical_align_bottom</mat-icon>
              </a><br></tr>
          </td>
        </ng-container>
        <ng-container matColumnDef="act">
          <th mat-header-cell *matHeaderCellDef class="mat-column-right">Actions</th>
          <td mat-cell *matCellDef="let element" class="mat-column-right">
            <button mat-button color="primary"
              routerLink="/marches/{{element.An}}-{{element.NumMarche}}"><mat-icon>remove_red_eye</mat-icon></button>
            <button mat-button color="" *ngIf="element.historique.length>0" (click)="historique(element.historique)"><mat-icon>history</mat-icon></button>
            <button mat-button color="accent" (click)="modifier(element)" *ngIf="droit>=1"><mat-icon>create</mat-icon></button>
            <button mat-button color="warn" (click)="suppmarche(element.An,element.NumMarche)" *ngIf="droit>=2"><mat-icon>delete_forever</mat-icon></button>
            <button mat-button style="color: darkblue" (click)="Telecharger(element)" ><mat-icon>vertical_align_bottom</mat-icon></button>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="ColumsFiles"></tr>
        <tr mat-row *matRowDef="let row; columns: ColumsFiles;"></tr>
      </table>
    </mat-tab>
  </mat-tab-group>
</div>